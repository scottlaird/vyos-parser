<interfaceDefinition>
  <node name="service">
    <properties>
      <help>System services</help>
    </properties>
    <children>
      <node name="stunnel" owner="${vyos_conf_scripts_dir}/service_stunnel.py">
        <properties>
          <help>Stunnel TLS Proxy</help>
          <priority>1000</priority>
        </properties>
        <children>
          <tagNode name="server">
            <properties>
              <help>Stunnel server config</help>
            </properties>
            <children>
<!-- include start from stunnel/connect.xml.i -->
<node name="connect">
  <properties>
    <help>Connect to a remote address</help>
  </properties>
  <children>
<!-- include start from stunnel/address.xml.i -->
<leafNode name="address">
  <properties>
    <help>Hostname or IP address</help>
    <valueHelp>
      <format>ipv4</format>
      <description>IPv4 address</description>
    </valueHelp>
    <valueHelp>
      <format>hostname</format>
      <description>hostname</description>
    </valueHelp>
    <constraint>
      <validator name="ip-address"/>
      <validator name="fqdn"/>
    </constraint>
    <constraintErrorMessage>Invalid FQDN or IP address</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from port-number.xml.i -->
<leafNode name="port">
  <properties>
    <help>Port number used by connection</help>
    <valueHelp>
      <format>u32:1-65535</format>
      <description>Numeric IP port</description>
    </valueHelp>
    <constraint>
      <validator name="numeric" argument="--range 1-65535"/>
    </constraint>
    <constraintErrorMessage>Port number must be in range 1 to 65535</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
  </children>
</node>
<!-- include end -->
<!-- include start from stunnel/listen.xml.i -->
<node name="listen">
  <properties>
    <help>Accept connections on specified address</help>
  </properties>
  <children>
<!-- include start from stunnel/address.xml.i -->
<leafNode name="address">
  <properties>
    <help>Hostname or IP address</help>
    <valueHelp>
      <format>ipv4</format>
      <description>IPv4 address</description>
    </valueHelp>
    <valueHelp>
      <format>hostname</format>
      <description>hostname</description>
    </valueHelp>
    <constraint>
      <validator name="ip-address"/>
      <validator name="fqdn"/>
    </constraint>
    <constraintErrorMessage>Invalid FQDN or IP address</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from port-number.xml.i -->
<leafNode name="port">
  <properties>
    <help>Port number used by connection</help>
    <valueHelp>
      <format>u32:1-65535</format>
      <description>Numeric IP port</description>
    </valueHelp>
    <constraint>
      <validator name="numeric" argument="--range 1-65535"/>
    </constraint>
    <constraintErrorMessage>Port number must be in range 1 to 65535</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
  </children>
</node>
<!-- include end -->
<!-- include start from stunnel/ssl.xml.i -->
<node name="ssl">
  <properties>
    <help>SSL Certificate, SSL Key and CA</help>
  </properties>
  <children>
<!-- include start from pki/ca-certificate-multi.xml.i -->
<leafNode name="ca-certificate">
  <properties>
    <help>Certificate Authority chain in PKI configuration</help>
    <completionHelp>
      <path>pki ca</path>
    </completionHelp>
    <valueHelp>
      <format>txt</format>
      <description>Name of CA in PKI configuration</description>
    </valueHelp>
    <multi/>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from pki/certificate.xml.i -->
<leafNode name="certificate">
  <properties>
    <help>Certificate in PKI configuration</help>
    <completionHelp>
      <path>pki certificate</path>
    </completionHelp>
    <valueHelp>
      <format>txt</format>
      <description>Name of certificate in PKI configuration</description>
    </valueHelp>
  </properties>
</leafNode>
<!-- include end -->
  </children>
</node>
<!-- include end -->
<!-- include start from stunnel/psk.xml.i -->
<tagNode name="psk">
  <properties>
    <help>Pre-shared key name</help>
  </properties>
  <children>
<!-- include start from auth-psk-id.xml.i -->
<leafNode name="id">
  <properties>
    <help>ID for authentication</help>
    <valueHelp>
      <format>txt</format>
      <description>ID used for authentication</description>
    </valueHelp>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from auth-psk-secret.xml.i -->
<leafNode name="secret">
  <properties>
    <help>pre-shared secret key</help>
    <valueHelp>
      <format>txt</format>
      <description>16byte pre-shared-secret key (32 character hexadecimal key)</description>
    </valueHelp>
    <constraint>
      <validator name="psk-secret"/>
    </constraint>
    <constraintErrorMessage>Pre-Shared-Keys must be at leas 16 bytes long, which implies at least 32 characterss</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
  </children>
</tagNode>
<!-- include end -->
              <leafNode name="protocol">
                <properties>
                  <help>Application protocol to negotiate TLS</help>
                  <completionHelp>
                    <list>cifs imap pgsql pop3 proxy smtp socks</list>
                  </completionHelp>
<!-- include start from stunnel/protocol-value-cifs.xml.i -->
<valueHelp>
  <format>cifs</format>
  <description>Proprietary (undocummented) extension of CIFS protocol</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-imap.xml.i -->
<valueHelp>
  <format>imap</format>
  <description>Based on RFC 2595 - Using TLS with IMAP, POP3 and ACAP</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-pgsql.xml.i -->
<valueHelp>
  <format>pgsql</format>
  <description>Based on PostgreSQL frontend/backend protocol</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-pop3.xml.i -->
<valueHelp>
  <format>pop3</format>
  <description>Based on RFC 2449 - POP3 Extension Mechanism</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-proxy.xml.i -->
<valueHelp>
  <format>proxy</format>
  <description>Passing of the original client IP address with HAProxy PROXY protocol version 1</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-smtp.xml.i -->
<valueHelp>
  <format>smtp</format>
  <description>Based on RFC 2487 - SMTP Service Extension for Secure SMTP over TLS</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-socks.xml.i -->
<valueHelp>
  <format>socks</format>
  <description>SOCKS versions 4, 4a, and 5 are supported</description>
</valueHelp>
<!-- include end -->
                  <constraint>
                    <regex>(cifs|imap|pgsql|pop3|proxy|smtp|socks)</regex>
                  </constraint>
                </properties>
              </leafNode>
            </children>
          </tagNode>
          <tagNode name="client">
            <properties>
              <help>Stunnel client config</help>
            </properties>
            <children>
<!-- include start from stunnel/connect.xml.i -->
<node name="connect">
  <properties>
    <help>Connect to a remote address</help>
  </properties>
  <children>
<!-- include start from stunnel/address.xml.i -->
<leafNode name="address">
  <properties>
    <help>Hostname or IP address</help>
    <valueHelp>
      <format>ipv4</format>
      <description>IPv4 address</description>
    </valueHelp>
    <valueHelp>
      <format>hostname</format>
      <description>hostname</description>
    </valueHelp>
    <constraint>
      <validator name="ip-address"/>
      <validator name="fqdn"/>
    </constraint>
    <constraintErrorMessage>Invalid FQDN or IP address</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from port-number.xml.i -->
<leafNode name="port">
  <properties>
    <help>Port number used by connection</help>
    <valueHelp>
      <format>u32:1-65535</format>
      <description>Numeric IP port</description>
    </valueHelp>
    <constraint>
      <validator name="numeric" argument="--range 1-65535"/>
    </constraint>
    <constraintErrorMessage>Port number must be in range 1 to 65535</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
  </children>
</node>
<!-- include end -->
<!-- include start from stunnel/listen.xml.i -->
<node name="listen">
  <properties>
    <help>Accept connections on specified address</help>
  </properties>
  <children>
<!-- include start from stunnel/address.xml.i -->
<leafNode name="address">
  <properties>
    <help>Hostname or IP address</help>
    <valueHelp>
      <format>ipv4</format>
      <description>IPv4 address</description>
    </valueHelp>
    <valueHelp>
      <format>hostname</format>
      <description>hostname</description>
    </valueHelp>
    <constraint>
      <validator name="ip-address"/>
      <validator name="fqdn"/>
    </constraint>
    <constraintErrorMessage>Invalid FQDN or IP address</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from port-number.xml.i -->
<leafNode name="port">
  <properties>
    <help>Port number used by connection</help>
    <valueHelp>
      <format>u32:1-65535</format>
      <description>Numeric IP port</description>
    </valueHelp>
    <constraint>
      <validator name="numeric" argument="--range 1-65535"/>
    </constraint>
    <constraintErrorMessage>Port number must be in range 1 to 65535</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
  </children>
</node>
<!-- include end -->
<!-- include start from stunnel/ssl.xml.i -->
<node name="ssl">
  <properties>
    <help>SSL Certificate, SSL Key and CA</help>
  </properties>
  <children>
<!-- include start from pki/ca-certificate-multi.xml.i -->
<leafNode name="ca-certificate">
  <properties>
    <help>Certificate Authority chain in PKI configuration</help>
    <completionHelp>
      <path>pki ca</path>
    </completionHelp>
    <valueHelp>
      <format>txt</format>
      <description>Name of CA in PKI configuration</description>
    </valueHelp>
    <multi/>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from pki/certificate.xml.i -->
<leafNode name="certificate">
  <properties>
    <help>Certificate in PKI configuration</help>
    <completionHelp>
      <path>pki certificate</path>
    </completionHelp>
    <valueHelp>
      <format>txt</format>
      <description>Name of certificate in PKI configuration</description>
    </valueHelp>
  </properties>
</leafNode>
<!-- include end -->
  </children>
</node>
<!-- include end -->
<!-- include start from stunnel/psk.xml.i -->
<tagNode name="psk">
  <properties>
    <help>Pre-shared key name</help>
  </properties>
  <children>
<!-- include start from auth-psk-id.xml.i -->
<leafNode name="id">
  <properties>
    <help>ID for authentication</help>
    <valueHelp>
      <format>txt</format>
      <description>ID used for authentication</description>
    </valueHelp>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from auth-psk-secret.xml.i -->
<leafNode name="secret">
  <properties>
    <help>pre-shared secret key</help>
    <valueHelp>
      <format>txt</format>
      <description>16byte pre-shared-secret key (32 character hexadecimal key)</description>
    </valueHelp>
    <constraint>
      <validator name="psk-secret"/>
    </constraint>
    <constraintErrorMessage>Pre-Shared-Keys must be at leas 16 bytes long, which implies at least 32 characterss</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
  </children>
</tagNode>
<!-- include end -->
              <leafNode name="protocol">
                <properties>
                  <help>Application protocol to negotiate TLS</help>
                  <completionHelp>
                    <list>cifs connect imap nntp pgsql pop3 proxy smtp socks</list>
                  </completionHelp>
<!-- include start from stunnel/protocol-value-cifs.xml.i -->
<valueHelp>
  <format>cifs</format>
  <description>Proprietary (undocummented) extension of CIFS protocol</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-connect.xml.i -->
<valueHelp>
  <format>connect</format>
  <description>Based on RFC 2817 - Upgrading to TLS Within HTTP/1.1, section 5.2 - Requesting a Tunnel with CONNECT</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-imap.xml.i -->
<valueHelp>
  <format>imap</format>
  <description>Based on RFC 2595 - Using TLS with IMAP, POP3 and ACAP</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-nntp.xml.i -->
<valueHelp>
  <format>nntp</format>
  <description>Based on RFC 4642 - Using Transport Layer Security (TLS) with Network News Transfer Protocol (NNTP)</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-pgsql.xml.i -->
<valueHelp>
  <format>pgsql</format>
  <description>Based on PostgreSQL frontend/backend protocol</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-pop3.xml.i -->
<valueHelp>
  <format>pop3</format>
  <description>Based on RFC 2449 - POP3 Extension Mechanism</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-proxy.xml.i -->
<valueHelp>
  <format>proxy</format>
  <description>Passing of the original client IP address with HAProxy PROXY protocol version 1</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-smtp.xml.i -->
<valueHelp>
  <format>smtp</format>
  <description>Based on RFC 2487 - SMTP Service Extension for Secure SMTP over TLS</description>
</valueHelp>
<!-- include end -->
<!-- include start from stunnel/protocol-value-socks.xml.i -->
<valueHelp>
  <format>socks</format>
  <description>SOCKS versions 4, 4a, and 5 are supported</description>
</valueHelp>
<!-- include end -->
                  <constraint>
                    <regex>(cifs|connect|imap|nntp|pgsql|pop3|proxy|smtp|socks)</regex>
                  </constraint>
                </properties>
              </leafNode>
<!-- include start from stunel/protocol-options.xml.i -->
<node name="options">
  <properties>
    <help>Advanced protocol options</help>
  </properties>
  <children>
    <leafNode name="authentication">
      <properties>
        <help>Authentication type for the protocol negotiations</help>
          <completionHelp>
            <list>basic ntlm plain login</list>
          </completionHelp>
          <valueHelp>
            <format>basic</format>
            <description>The default 'connect' authentication type</description>
          </valueHelp>
          <valueHelp>
            <format>ntlm</format>
            <description>Supported authentication types for the 'connect' protocol</description>
          </valueHelp>
          <valueHelp>
            <format>plain</format>
            <description>The default 'smtp' authentication type</description>
          </valueHelp>
          <valueHelp>
            <format>login</format>
            <description>Supported authentication types for the 'smtp' protocol</description>
          </valueHelp>
          <constraint>
            <regex>(basic|ntlm|plain|login)</regex>
          </constraint>
      </properties>
    </leafNode>
    <leafNode name="domain">
      <properties>
        <help>Domain for the 'connect' protocol.</help>
        <valueHelp>
          <format>domain</format>
          <description>domain</description>
        </valueHelp>
        <constraint>
          <validator name="fqdn"/>
        </constraint>
      </properties>
    </leafNode>
    <node name="host">
      <properties>
        <help>Destination address for the 'connect' protocol</help>
      </properties>
      <children>
<!-- include start from stunnel/address.xml.i -->
<leafNode name="address">
  <properties>
    <help>Hostname or IP address</help>
    <valueHelp>
      <format>ipv4</format>
      <description>IPv4 address</description>
    </valueHelp>
    <valueHelp>
      <format>hostname</format>
      <description>hostname</description>
    </valueHelp>
    <constraint>
      <validator name="ip-address"/>
      <validator name="fqdn"/>
    </constraint>
    <constraintErrorMessage>Invalid FQDN or IP address</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
<!-- include start from port-number.xml.i -->
<leafNode name="port">
  <properties>
    <help>Port number used by connection</help>
    <valueHelp>
      <format>u32:1-65535</format>
      <description>Numeric IP port</description>
    </valueHelp>
    <constraint>
      <validator name="numeric" argument="--range 1-65535"/>
    </constraint>
    <constraintErrorMessage>Port number must be in range 1 to 65535</constraintErrorMessage>
  </properties>
</leafNode>
<!-- include end -->
      </children>
    </node>
    <leafNode name="password">
      <properties>
        <help>Password for the protocol negotiations</help>
        <valueHelp>
          <format>txt</format>
          <description>Authentication password</description>
        </valueHelp>
      </properties>
    </leafNode>
    <leafNode name="username">
      <properties>
        <help>Username for the protocol negotiations</help>
        <valueHelp>
          <format>txt</format>
          <description>Authentication username</description>
        </valueHelp>
      </properties>
    </leafNode>
  </children>
</node>
<!-- include end -->
            </children>
          </tagNode>
          <node name="log">
            <properties>
              <help>Service logging</help>
            </properties>
            <children>
              <leafNode name="level">
                <properties>
                  <help>Specifies log level.</help>
                  <completionHelp>
                    <list>emerg alert crit err warning notice info debug</list>
                  </completionHelp>
                  <valueHelp>
                    <format>emerg</format>
                    <description>Emerg log level</description>
                  </valueHelp>
                  <valueHelp>
                    <format>alert</format>
                    <description>Alert log level</description>
                  </valueHelp>
                  <valueHelp>
                    <format>crit</format>
                    <description>Critical log level</description>
                  </valueHelp>
                  <valueHelp>
                    <format>err</format>
                    <description>Error log level</description>
                  </valueHelp>
                  <valueHelp>
                    <format>warning</format>
                    <description>Warning log level</description>
                  </valueHelp>
                  <valueHelp>
                    <format>notice</format>
                    <description>Notice log level</description>
                  </valueHelp>
                  <valueHelp>
                    <format>info</format>
                    <description>Info log level</description>
                  </valueHelp>
                  <valueHelp>
                    <format>debug</format>
                    <description>Debug log level</description>
                  </valueHelp>
                  <constraint>
                    <regex>(emerg|alert|crit|err|warning|notice|info|debug)</regex>
                  </constraint>
                </properties>
                <defaultValue>notice</defaultValue>
              </leafNode>
            </children>
          </node>
        </children>
      </node>
    </children>
  </node>
</interfaceDefinition>
